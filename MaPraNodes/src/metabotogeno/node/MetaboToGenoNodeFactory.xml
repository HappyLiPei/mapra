<?xml version="1.0" encoding="UTF-8"?>
<knimeNode icon="./IconMetabolite.png" type="Manipulator" xmlns="http://knime.org/node/v2.8" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://knime.org/node/v2.10 http://knime.org/node/v2.10.xsd">
    <name>MetaboToGeno</name>
    
    <shortDescription>
        Transfer of metabolite scores to genes
    </shortDescription>
    
    <fullDescription>
        <intro>
        	<b>MetaboToGeno</b> is part of the metabotype analysis implemented in <b>PheNoBo</b>.
        	This node is the successor of the <b>ScoreMetabolites</b> node and a predecessor of the <b>NetworkScore</b> node.
        	<br/><br/>
        	The aim of MetaboToGeno is to transform the per-metabolite results of ScoreMetabolites into predictions of causal genes.
        	The MetaboToGeno algorithm calculates a score for each gene based on the p values reported by ScoreMetabolites.
        	The score of a gene <i>x</i> indicates the probability that <i>x</i> is the causal gene for the patient's disease given the observed metabotype.
        	<br/><br/>
        	MetaboToGeno requires 3 tables with input data: the metabolite scores, the metabolite-gene associations and the set of all genes to score.
        	For detailed information about the format of the tables have a look at the Input Port section and 
        	at the example files provided at <a href="https://github.com/marie-sophie/mapra">https://github.com/marie-sophie/mapra</a>.
        	<br/><br/>
        	The MetaboToGeno algorithm is a procedure with 2 main steps.
        	<br/>
        	The first step of the procedure is a score transformation at metabolite level.
        	The p value of each metabolite is converted to the probability that the metabolite is associated with the patient's disease. 
        	A metabolite with p value <i>p</i> gets a new score 1/(1+np) where <i>n</i> denotes the total number of metabolites.
        	<br/>
        	The second step transfers a metabolite score to all genes that have an association with that metabolite.
        	If a metabolite does not have any known associations, its score is distributed among all genes.
        	There are several methods (see dialog options) to handle genes that obtain scores from more than one metabolite.
        </intro>
        
        <option name="Gene Annotation Mode">
        	This option specifies how MetaboToGeno handles genes that obtain scores from more than one metabolite.
        	There are two possible modes.
        	<br/>
        	<b>Combination of all metabolite scores</b>:
        		This method combines the scores of all metabolites annotated to a gene.
        		The final score of a gene is determined as (1-s<sub>1</sub>)(1-s<sub>2</sub>)...(1-s<sub>n</sub>) with s<sub>1</sub> to s<sub>n</sub> denoting the scores of its metabolites.
        	<br/>
        	<b>Maximum metabolite score</b>:
        		This method takes the maximum score of all metabolites annotated to a gene.
        		The final score of a gene is determined as max(s<sub>1</sub>,s<sub>2</sub>,...,s<sub>n</sub>) with s<sub>1</sub> to s<sub>n</sub> denoting the scores of its metabolites.
        </option>

    </fullDescription>
    
    <ports>
        <inPort index="0" name="ScoreMetabolites">
            <b>Output of ScoreMetabolites</b>: a table produced by the ScoreMetabolites node.
        	MetaboToGeno requires not all columns generated by ScoreMetabolites.
        	This node only depends on the columns <b>metabolite_id</b> and <b>significance</b>.
    	</inPort>
        <inPort index="1" name="Metabolite Gene Association">
        	<b>Associations Metabolite - Gene</b>: a table representing associations between metabolites and genes.
        	These associations can include indirect relations (e.g. results from GWAS) and data about biochemical reactions (e.g. gene <i>x</i> catalyzes a reaction that forms metabolite <i>y</i>).
        	The table should have two columns named <b>metabolite_id</b> and <b>gene_id</b>.
    		The associations are represented as pairs metabolite id (e.g. Metabolon id) - gene id (e.g. Ensmebl id).
    		Note that the gene id is allowed to be missing (for a metabolite without known genes) whereas the metabolite id is required in every row. 
    		<br/> <b>All metabolites that should be considered in the MetaboToGeno algorithm have to occur at least once in the table</b>.
    	</inPort>
        <inPort index="2" name="All Genes">
        	<b>All genes</b>: a table with a single column <b>gene_id</b>.
        	It contains gene ids (e.g. Ensembl gene ids) of all genes to score.
    	</inPort>
        <outPort index="0" name="Gene Scores"> 
        	<b>Gene Scores</b>:
            Each row represents a gene from the table at Input Port 2 and consists of 3 columns: <b>gene_id</b>, <b>gene_probability</b> and <b>contribution</b>.
        	The gene probability gives the likelihood that the gene is causal for the patient's metabotype.
        	The column contribution lists the metabolites that contributed most to the score of the gene.
    	</outPort>
    </ports>    
</knimeNode>
