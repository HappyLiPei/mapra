<?xml version="1.0" encoding="UTF-8"?>
<knimeNode icon="./IconDisease.png" type="Manipulator" xmlns="http://knime.org/node/v2.8" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://knime.org/node/v2.10 http://knime.org/node/v2.10.xsd">
    <name>PhenoToGeno</name>
    
    <shortDescription>
        Transfer of disease scores to genes
    </shortDescription>
    
    <fullDescription>
        <intro>
        	<b>PhenoToGeno</b> is part of the phenotype analysis implemented in <b>PheNoBo</b>.
        	This node is the successor of the <b>Phenomizer</b> node and a predecessor of the <b>NetworkScore</b> node.
        	<br/><br/>
        	The aim of PhenoToGeno is to transform the per-disease results of Phenomizer into predictions of causal genes.
        	The PhenoToGeno algorithm calculates a score for each gene based on the p values reported by Phenomizer.
        	The score of a gene <i>x</i> indicates the probability that <i>x</i> is the causal gene for the patient's disease given the observed symptoms.
        	<br/><br/>
        	PhenoToGeno requires 3 tables with input data: the disease scores, the disease-gene associations and the set of all genes to score.
        	For detailed information about the format of the tables have a look at the example files provided at
        	<a href="https://github.com/marie-sophie/mapra">https://github.com/marie-sophie/mapra</a>.
        	<br/><br/>
        	The PhenoToGeno algorithm is a procedure with 2 main steps.
        	<br/>
        	The first step of the method is a score transformation at disease level.
        	The p value of each disease is converted to the probability that the patient suffers from the disease. 
        	A disease with p value <i>p</i> gets a new score s=1/(1+np) where <i> n </i> denotes the total number of diseases.
        	<br/>
        	The second step transfers a disease score to all genes that have an association with that disease.
        	If a disease does not have any known associations, its score is distributed among all genes.
        	There are several methods (see dialog options) to handle genes that obtain scores from more than one disease.
        	<br/><br/>
    	</intro>
        
        
        <option name="Gene Annotation Mode">
        	This option specifies how PhenoToGeno handles genes that obtain scores from more than one disease.
        	There are two possible modes.
        	<br/>
        	<b>Combination of all disease scores</b>:
        		This method combines the scores of all diseases annotated to a gene.
        		The final score of a gene is determined as (1-s<sub>1</sub>)(1-s<sub>2</sub>)...(1-s<sub>n</sub>) with s<sub>1</sub> to s<sub>n</sub> denoting the scores of its diseases.
        	<br/>
        	<b>Maximum disease score</b>:
        		This method takes the maximum score of all diseases annotated to a gene.
        		The final score of a gene is determined as max(s<sub>1</sub>,s<sub>2</sub>,...,s<sub>n</sub>) with s<sub>1</sub> to s<sub>n</sub> denoting the scores of its diseases.
    	</option>

    </fullDescription>
    
    <ports>
        <inPort index="0" name="Phenomizer">
        	<b>Output of Phenomizer</b>: a table produced by the Phenomizer node.
        	PhenoToGeno requires not all columns generated by Phenomizer.
        	This node only depends on the columns <b>disease_id</b> and <b>p_value</b>.
    	</inPort>
        <inPort index="1" name="Disease Gene Association">
        	<b>Associations Disease - Gene</b>: a table representing associations between diseases and genes.
        	These associations should comprise all known causal genes for the diseases of PhenoDis.
        	The table should have two columns named <b>disease_id</b> and <b>gene_id</b>.
    		The associations are represented as pairs PhenoDis disease id - gene id (e.g. Ensmebl id).
    		Note that the gene id is allowed to be missing (for a disease without known genes) whereas the disease id is required in every row. 
    		<br/> <b>All diseases that should be considered in the PhenoToGeno algorithm have to occur at least once in the table</b>.
    	</inPort>
        <inPort index="2" name="All Genes">
        	<b>All genes</b>: a table with a single column <b>gene_id</b>.
        	It contains gene ids (e.g. Ensembl gene ids) of all genes to score.
    	</inPort>
        <outPort index="0" name="Gene Scores">
        	<b>Gene Scores</b>:
        	Each row represents a gene from the table at Input Port 2 and consists of 3 columns: <b>gene_id</b>, <b>gene_probability</b> and <b>contribution</b>.
        	The gene probability gives the likelihood that the gene is causal for the patient's disease.
        	The column contribution lists the diseases that contributed most to the score of the gene.
    	</outPort>
    </ports>    

</knimeNode>
